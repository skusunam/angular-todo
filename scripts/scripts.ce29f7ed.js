"use strict";!function(){function a(a,b){a.$on("$routeChangeError",function(a){console.log("$routeChangeError"),a.authenticated||b.path("/login")})}function b(a){function b(a,b){return b.isUserLoggedIn()?a.when(!0):a.reject({authenticated:!1})}Parse.initialize("quEQw1Yal6U7nYh9JUZ3eefGky4zF1kPpJOMzhwU","2Cvg0ii5WHeVxU5ypCKeEwW1uAuB0y76u2ycYIlm"),a.when("/",{templateUrl:"views/main.html"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl",controllerAs:"signup"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).when("/todos",{templateUrl:"views/todos.html",controller:"TodosCtrl",controllerAs:"todos",resolve:{isAuthenticated:b}}).otherwise({redirectTo:"/"}),b.$inject=["$q","UserService"]}angular.module("angularTodoApp",["ngRoute","ngAnimate","cgBusy"]).run(a).config(b),a.$inject=["$rootScope","$location"],b.$inject=["$routeProvider"]}(),function(){function a(a,b,c){function d(){console.log(e.registeredUser);var d=b.signUp(e.registeredUser);e.busyPromise=d,d.then(function(){c.setMessage("User Saved Succesfully. Please login with your credentials."),console.log(e.status),a.path("/login")})}console.log("SignupController called");var e=this;e.save=d,e.registeredUser={firstName:"",lastName:"",email:"",password:""}}angular.module("angularTodoApp").controller("SignupCtrl",a),a.$inject=["$location","ParseService","UserService"]}(),function(){function a(a){function b(b){var c=Parse.Object.extend("TodoUser"),d=new c;d.set("email",b.email),d.set("firstName",b.firstName),d.set("lastName",b.lastName),d.set("password",b.password);var e=a.defer();return d.save({success:function(a){e.resolve(a)},error:function(a){console.log("signup: error",a),e.reject(a)}}),e.promise}function c(b,c){var d=Parse.Object.extend("TodoUser"),e=new Parse.Query(d);e.equalTo("email",b),e.equalTo("password",c);var f=a.defer();return e.count({success:function(a){f.resolve(a)},error:function(a){console.log("login: error",a),f.reject(a)}}),f.promise}function d(){var b=Parse.Object.extend("Todos"),b=Parse.Collection.extend({model:b}),c=new b,d=a.defer();return c.fetch({success:function(a){console.log("collection ",a),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise}function e(b){var c=Parse.Object.extend("Todos"),d=new c;d.set("title",b),d.set("isComplete",!1);var e=a.defer();return d.save({success:function(a){e.resolve(a)},error:function(a){console.log("Error happened while saving '"+b+"' to Parse.",a),e.reject(a)}}),e.promise}function f(b){var c=Parse.Object.extend("Todos"),d=new Parse.Query(c),e=a.defer();return d.get(b.id,{success:function(a){a.destroy({success:function(a){e.resolve(a)},error:function(a){e.reject(a)}})},error:function(a){e.reject(a)}}),e.promise}function g(b){var c=Parse.Object.extend("Todos"),d=new Parse.Query(c),e=a.defer();return d.get(b.id,{success:function(a){a.set("isComplete",b.isComplete),a.save({success:function(){console.log("todo's icCompleted updated succesfully",a.get("isComplete")),e.resolve()},error:function(){e.reject(error)}})},error:function(a){e.reject(a)}}),e.promise}function h(b){var c=[];return b.forEach(function(a){c.push(g(a))}),console.log("promises = ",c),a.all()}var i={signup:b,login:c,getTodos:d,addTodo:e,removeTodo:f,todoCompleted:g,markAllComplete:h};return i}angular.module("angularTodoApp").factory("ParseService",a),a.$inject=["$q"]}(),function(){function a(){var a,b={},c=!1;this.setMessage=function(b){a=b},this.getMessage=function(){return a},this.getUser=function(){return b},this.setUser=function(a){b=a},this.setUserLoggedIn=function(a){c=a},this.isUserLoggedIn=function(){return c}}angular.module("angularTodoApp").service("UserService",a)}(),function(){function a(a,b,c){function d(){console.log(e.user.username,e.user.password);var d=c.login(e.user.username,e.user.password);e.busyPromise=d,d.then(function(c){console.log("user count = "+c),0===c?e.message="Invalid credentials. Please verify email/password":(b.setMessage(""),b.setUserLoggedIn(!0),a.path("/todos"))})}var e=this;e.message=b.getMessage(),e.login=d,e.user={username:"",password:""}}angular.module("angularTodoApp").controller("LoginCtrl",a),a.$inject=["$location","UserService","ParseService"]}(),function(){function a(a){function b(){var b=g.newTodo.trim();if(0!==b.length){var c=a.addTodo(g.newTodo);g.busyPromise=c,c.then(function(a){g.newTodo="",g.todos.push(_.extend(a.attributes,{id:a.id}))})}}function c(b){console.log("removeTodo",g.todos,b);var c=a.removeTodo(b);g.busyPromise=c,c.then(function(){g.todos.splice(g.todos.indexOf(b),1)})}function d(b){console.log("todoCompleted ",b),g.busyPromise=a.todoCompleted(b)}function e(b){g.allChecked=!b,console.log("markAll : isComplete "+g.allChecked),g.todos.forEach(function(a){a.isComplete=g.allChecked?!0:!1});var c=a.markAllComplete(g.todos);g.busyPromise=c}function f(){var b=a.getTodos();g.busyPromise=b,b.then(function(a){g.newTodo=null,g.todos=[],a.each(function(a){g.todos.push(_.extend(a.attributes,{id:a.id}))})})}var g=this;g.newTodo="",g.allChecked=!1,g.addTodo=b,g.removeTodo=c,g.todoCompleted=d,g.markAll=e,f()}angular.module("angularTodoApp").controller("TodosCtrl",a),a.$inject=["ParseService","UserService"]}(),function(){function a(a,b,c){var d=this;d.loggedIn=!1,d.logout=function(){c.setUserLoggedIn(!1),b.path("/login")},a.$watch(c.isUserLoggedIn,function(a){d.loggedIn=a})}angular.module("angularTodoApp").controller("NavCtrl",a),a.$inject=["$scope","$location","UserService"]}();